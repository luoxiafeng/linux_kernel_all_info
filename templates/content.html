{% extends 'base.html' %}

{% block content %}
<h1>节点内容层次结构</h1>

<div class="search-container">
    <input type="text" id="search-input" placeholder="输入内容搜索..." />
    <button onclick="searchContent()">搜索</button>
</div>

<ul id="tree-root">
    {% for node in root.children %}
    <li>
        <span class="node" onclick="toggleChildrenAndContent(this)">{{ node.path }}</span>
        <div class="content">
            <pre>
<strong>节点属性:</strong>
addr_cells: {{ node.attr.addr_cells }}
size_cells: {{ node.attr.size_cells }}
refnodeattr: {{ node.attr.refnodeattr }}
phandle: {{ node.attr.phandle }}
compatible: {{ node.attr.compatible }}
regaddr: {{ node.attr.regaddr | join(', ') }}
regsize: {{ node.attr.regsize | join(', ') }}
            </pre>
            <pre><strong>节点内容:</strong>
{{ node.content | join('\n') }}
            </pre>
        </div>
        <ul class="children">
            {% for child in node.children %}
            <li>
                <span class="node" onclick="toggleChildrenAndContent(this)">{{ child.path }}</span>
                <div class="content">
                    <pre>
<strong>节点属性:</strong>
addr_cells: {{ child.attr.addr_cells }}
size_cells: {{ child.attr.size_cells }}
refnodeattr: {{ child.attr.refnodeattr }}
phandle: {{ child.attr.phandle }}
compatible: {{ child.attr.compatible }}
regaddr: {{ child.attr.regaddr | join(', ') }}
regsize: {{ child.attr.regsize | join(', ') }}
                    </pre>
                    <pre><strong>节点内容:</strong>
{{ child.content | join('\n') }}
                    </pre>
                </div>
                <ul class="children">
                    {% for grandchild in child.children %}
                    <li>
                        <span class="node" onclick="toggleChildrenAndContent(this)">{{ grandchild.path }}</span>
                        <div class="content">
                            <pre>
<strong>节点属性:</strong>
addr_cells: {{ grandchild.attr.addr_cells }}
size_cells: {{ grandchild.attr.size_cells }}
refnodeattr: {{ grandchild.attr.refnodeattr }}
phandle: {{ grandchild.attr.phandle }}
compatible: {{ grandchild.attr.compatible }}
regaddr: {{ grandchild.attr.regaddr | join(', ') }}
regsize: {{ grandchild.attr.regsize | join(', ') }}
                            </pre>
                            <pre><strong>节点内容:</strong>
{{ grandchild.content | join('\n') }}
                            </pre>
                        </div>
                        <ul class="children">
                            {% for greatgrandchild in grandchild.children %}
                            <li>
                                <span class="node" onclick="toggleChildrenAndContent(this)">{{ greatgrandchild.path }}</span>
                                <div class="content">
                                    <pre>
<strong>节点属性:</strong>
addr_cells: {{ greatgrandchild.attr.addr_cells }}
size_cells: {{ greatgrandchild.attr.size_cells }}
refnodeattr: {{ greatgrandchild.attr.refnodeattr }}
phandle: {{ greatgrandchild.attr.phandle }}
compatible: {{ greatgrandchild.attr.compatible }}
regaddr: {{ greatgrandchild.attr.regaddr | join(', ') }}
regsize: {{ greatgrandchild.attr.regsize | join(', ') }}
                                    </pre>
                                    <pre><strong>节点内容:</strong>
{{ greatgrandchild.content | join('\n') }}
                                    </pre>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endfor %}
                </ul>
            </li>
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>

<script>
    // 展开/收起子节点和内容
    function toggleChildrenAndContent(element) {
        var children = element.nextElementSibling.nextElementSibling;
        var content = element.nextElementSibling;

        if (content.style.display === "block") {
            content.style.display = "none"; // 隐藏内容
        } else {
            content.style.display = "block"; // 显示内容
        }

        if (children) {
            if (children.style.display === "block") {
                children.style.display = "none"; // 收起子节点
            } else {
                children.style.display = "block"; // 展开子节点
            }
        }
    }
</script>

<style>
    .search-container {
        margin-bottom: 20px;
    }

    .search-container input {
        padding: 5px;
        font-size: 16px;
        width: 200px;
    }

    .search-container button {
        padding: 5px 10px;
        font-size: 16px;
        background-color: #007BFF;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
    }

    .search-container button:hover {
        background-color: #0056b3;
    }

    .highlight {
        background-color: yellow;
        font-weight: bold;
    }

    .content pre {
        background-color: #f8f9fa;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-family: monospace;
        overflow-x: auto;
        margin-bottom: 10px;
    }
</style>
{% endblock %}
